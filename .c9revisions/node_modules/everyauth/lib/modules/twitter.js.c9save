{"ts":1353870939616,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var oauthModule = require('./oauth')\n  , url = require('url');\n\nvar twitter = module.exports =\noauthModule.submodule('twitter')\n  .apiHost('https://api.twitter.com')\n  .oauthHost('https://api.twitter.com')\n  .entryPath('/auth/twitter')\n  .callbackPath('/auth/twitter/callback')\n  .authorizePath('/oauth/authenticate')\n  .fetchOAuthUser( function (accessToken, accessTokenSecret, params) {\n    var promise = this.Promise();\n    this.oauth.get(this.apiHost() + '/1/users/show.json?user_id=' + params.user_id, accessToken, accessTokenSecret, function (err, data, res) {\n      if (err) {\n        err.extra = {data: data, res: res};\n        return promise.fail(err);\n      }\n      var oauthUser = JSON.parse(data);\n      promise.fulfill(oauthUser);\n    });\n    return promise;\n  })\n  .authCallbackDidErr( function (req) {\n    var parsedUrl = url.parse(req.url, true);\n    return parsedUrl.query && !!parsedUrl.query.denied;\n  })\n  .handleAuthCallbackError( function (req, res) {\n    if (res.render) {\n      res.render(__dirname + '/../views/auth-fail.jade', {\n        errorDescription: 'The user denied your request'\n      });\n    } else {\n      // TODO Replace this with a nice fallback\n      throw new Error(\"You must configure handleAuthCallbackError if you are not using express\");\n    }\n  })\n  .moduleErrback( function (err, seqValues) {\n    if (err instanceof Error) {\n      var next = seqValues.next;\n      return next(err);\n    } else if (err.extra) {\n      var twitterResponse = err.extra.res\n        , serverResponse = seqValues.res;\n      serverResponse.writeHead(\n          twitterResponse.statusCode\n        , twitterResponse.headers);\n      serverResponse.end(err.extra.data);\n    } else if (err.statusCode) {\n      var serverResponse = seqValues.res;\n      serverResponse.writeHead(err.statusCode);\n      serverResponse.end(err.data);\n    } else {\n      console.error(err);\n      throw new Error('Unsupported error type');\n    }\n  });\n"]],"start1":0,"start2":0,"length1":0,"length2":1945}]],"length":1945}
